# 12 - Security & Privacy Framework

**Last Updated**: 2024-07-23

## 1. Guiding Principles
- **Least Privilege**: Both the system and users are only granted the absolute minimum permissions required to perform their functions.
- **Defense in Depth**: We use multiple layers of security controls. A failure in one layer should not lead to a full system compromise.
- **Data Minimization**: We only collect and store data that is essential for the application to function.
- **Secure by Design**: Security is not an afterthought; it is a core consideration in the design of every feature.

## 2. Authentication & Authorization
- **Provider**: Authentication is handled exclusively through GitHub OAuth via NextAuth.js for the MVP. This delegates password security to a trusted, industry-standard provider.
- **Session Management**: Secure, HTTP-only cookies are used to manage user sessions, mitigating XSS risks.
- **Authorization**: All API endpoints enforce authorization checks, ensuring that a user can only ever access data associated with their own `user_id`.

## 3. Data Security
- **Data Segregation**: Multi-tenancy is enforced at the database level using PostgreSQL's Row-Level Security (RLS). This ensures that even a flawed API query cannot accidentally leak data from another user.
- **Encryption at Rest**: All sensitive data, particularly user GitHub OAuth tokens, are encrypted before being stored in the database.
- **Encryption in Transit**: All communication between the user's browser, the Next.js frontend, the AI integration layer, and the database is encrypted using TLS 1.2 or higher.
- **Data Retention**: A clear data retention policy will be established. Users will have the right to request the deletion of their account and all associated data.

## 4. GitHub Integration Security
- **OAuth Scope Minimization**: We will only request the `repo` and `user:email` scopes from GitHub. We will provide a clear, user-facing explanation for why these specific permissions are required. We will never ask for organization-level or private repository read access beyond what we need to create a new repo.
- **Token Handling**:
    - User OAuth tokens are treated as highly sensitive secrets.
    - They are encrypted at rest.
    - They are only ever accessed by the isolated, secure background worker during the code generation pipeline.
    - They are never exposed to the frontend or stored in logs.
- **Repository Creation**: For the MVP, all repositories generated by Vibe Lab will be created as **private** by default, giving the user full control over their code's visibility.

## 5. AI & Prompt Security
- **Prompt Injection**: The AI integration layer will include defenses against prompt injection. It will sanitize user input, clearly delineate between instructions and user-provided content in the prompts sent to Gemini, and use system prompts to constrain the AI's behavior.
- **Data Privacy**: No user-provided data from one tenant will ever be used in prompts for another tenant. All AI interactions are strictly isolated.
- **Audit Logging**: All significant AI operations (e.g., generating a foundation) will be logged for security and auditing purposes.

## 6. Regular Audits
- The system will undergo regular security audits, both automated (dependency scanning, static analysis) and manual, to identify and remediate potential vulnerabilities. 